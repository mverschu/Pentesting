#!/bin/bash
# Mathijs Verschuuren - 05-2022

RED='\033[0;31m'
NC='\033[0m' # No Color

printf "${RED}Enumerating SMB service...\n${NC}"
nmap -Pn -p 139,445 -T5 $1
nmblookup -A $1
crackmapexec --timeout 5 smb $1
crackmapexec --timeout 5 smb $1 --port 139 
crackmapexec --timeout 5 smb -u "" -p "" $1
crackmapexec --timeout 5 smb $1 -u "" -p "" --port 139
printf "${RED}Trying to list shares...\n${NC}"
smbmap -H $1
smbmap -H $1 -P 139
printf "${RED}smbclient requires second parameter for sharename\n${NC}"
smbclient \\\\$1\\$2
printf "${RED}Checking vulns...\n${NC}"
nmap -Pn -T4 --script 'smb-vuln*' -p 139,445 $1
printf "${RED}Enumerating SMB service using NULL-sessions...\n${NC}"
printf "${RED}Sometimes this does timeout and won't stop, comment the 4 commands to proceed...\n${NC}"
crackmapexec --timeout 5 smb $1 -u "" -p "" --users
crackmapexec --timeout 5 smb $1 -u "" -p "" --users --port 139
crackmapexec --timeout 5 smb 10.11.1.115 -u "" -p "" --pass-pol
crackmapexec --timeout 5 smb 10.11.1.115 -u "" -p "" --port 139 --pass-pol
printf "${RED}Starting enum4linux...\n${NC}"
enum4linux -a $1
echo "----------------------------------------------------------"
printf "${RED}Try manually running: rpcclient -U "" -N [ip]\n${NC}"
printf "${RED}Also try WireShark to enum the version if not identified yet!\n${NC}"
